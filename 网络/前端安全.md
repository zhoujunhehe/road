# 前端安全
## XSS (cross site scripting) 跨站脚本
Xss 是一种代码注入攻击,攻击者在目标页面注入恶意代码,用户登入这些网页的时候,恶意代码就会和正常代码一起执行,脚本可以读取用户信息,包括cookie session token ,对用户进行欺诈或者蠕虫攻击
- - - -
## 1.反射型
> **攻击步骤**  
	1. 攻击者将恶意代码携带在url当中
	2. 当用户打开URL时,服务端会将带有恶意代码的HTML文档返回执行,
	3. 恶意代码窃取用户数据,冒充用户行为,执行相应的攻击
反射型攻击通常需要用户点击通过链接传递参数的url,比如搜索,页面跳转,  	所以大多数攻击者会诱导用户点击连接
	有一些现代的浏览器能主动识别URL链接中的xss攻击,将网页拦截,比如chrome 和Safari
> **如何防范 反射型xss攻击?**  
	**对字符串进行编码。**对url的查询参数进行转义后再输出到页面。

- - - -
## 2. DOM型
Dom型 Xss攻击就是JavaScript不严谨  过于相信用户输入,攻击者的代码通过innerHTML ,outerHTML,appendChild,doucument.write()等方法注入页面并执行

> **攻击步骤**  

1. 攻击者将一段恶意js脚本包装成用户输入
2. 用户浏览器运行了恶意js脚本
3. 恶意代码窃取用户数据,冒充用户行为,执行相应的攻击

> **如何防范DOM型xss攻击**  

对用户的输入进行转义
1. 对于url链接(例如图片的src属性)，那么直接使用 encodeURIComponent 来转义。
2. 非url，我们可以这样进行编码：
```function encodeHtml(str) {
    return str.replace(/"/g, '&quot;')
            .replace(/'/g, '&apos;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;');
}
```

- - - -
## 3.存储型
存储型XSS攻击可以说是反射型XSS攻击的升级版.恶意脚本永久存储在服务器中,不仅仅影响一个用户,而是所有请求改页面的用户都将受到攻击.也比较难实现.需要在1.前端数据提交不过滤转义 2.客户端存储数据不过滤转义 3. 前端从服务器获取数据不过滤转义

> **存储型 XSS 的攻击步骤：**  

1. 攻击者将恶意代码提交到目标网站的数据库中。
2. 用户打开目标网站时，网站服务端将恶意代码从数据库取出，拼接在 HTML 中返回给浏览器。
3. 用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。
4. 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

> 如何防范存储型XSS攻击  
1. 前端数据传递给服务器之前，先转义/过滤(防范不了抓包修改数据的情况)
2. 服务器接收到数据，在存储到数据库之前，进行转义/过滤
3. 前端接收到服务器传递过来的数据，在展示到页面前，先进行转义/过滤

**除了转义,还有什么可以防范xss攻击**

1. content security policy
设置CSP只允许加载同域资源
在服务端使用 HTTP的 Content-Security-Policy### 头部来指定策略
`Content-Security-Policy: default-src ‘self’`
或者在页面中设置meta标签
`<meta http-equiv=“Content-Security-Policy” content=“form-action ‘self’;”>`

2. 输入内容长度限制
3. 输入内容类型限制
4. 验证码
5. HTTP-only :只能通过服务端修改cookie,js获取不到


- - - -

## 	CSRF ( cross site request forgery ) 跨站请求伪造
Csrf攻击是用户访问攻击者搭建的第三方网站,  第三方网站获取用户的凭证信息,向被攻击网站发送恶意请求,绕过服务端的验证,冒充用户操作.

> **攻击流程**  

1. 用户登入被攻击网站,并保留了用户凭证(cookie)
2. 攻击者诱导用户点击了恶意网站
3. 向被攻击网站发起请求,浏览器会默认携带被攻击网站的cookie
4. 被攻击网站收到请求,并且验证通过,误以为是正常的请求
5. 被攻击网站以用户的名义执行了恶意请求

> **CSRF的特点**  

1. 通常在第三方网站发起,攻击无法被防止
2. 利用了被攻击网站的登录凭证,冒充受害者操作
3. 并不需要主动获取cookie
4. 可以试用各种方式,图片URL,超链接,CORS,FORM表单提交

> **如何防御CSRF攻击**  

1. 使用验证码
2. 使用TOKEN
3. 使用samesite : strict禁用第三方cookie
为Set-Cookie响应头新增Samesite属性,同站cookie只能作为第一方cookie,不能作为第三方cookie,



