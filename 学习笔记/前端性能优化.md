# 前端性能优化
一个页面是如何加载的?
输入URL - 浏览器导航 - 解析页面 - 展示页面
![](%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/1b49976aca2c700883d48d927f48986c.png)

![](%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/975fcbf7f83cc20d216f3d68a85d0f37.png)

在chrome 中 完整打开一个页面需要多个进程之间的配合,包括浏览器进程,网络进程,渲染进程
* 浏览器进程主要负责用户交互、子进程管理和文件储存等功能。
* 网络进程是面向渲染进程和浏览器进程等提供网络下载功能。
* 渲染进程的主要职责是把从网络下载的 HTML、JavaScript、CSS、图片等资源解析为可以显示和交互的页面。因为渲染进程所有的内容都是通过网络获取的，会存在一些恶意代码利用浏览器漏洞对系统进行攻击，所以运行在渲染进程里面的代码是不被信任的。这也是为什么 Chrome 会让渲染进程运行在安全沙箱里，就是为了保证系统的安全。

1. 首先是浏览器进程需要处理用户的输入,
2. 如果输入的是关键词,就提供搜索,如果是合法的URL 则到下一步解析


## 渲染过程(都在渲染进程里)
### 主线程
- - - -
1. 根据HTML文档解析成DOM树
2. 根据CSS解析成样式表,同时计算每个节点的样式
3. 创建布局树
4. 对布局树分层,生成分层树,在老版本的实现里可能叫渲染树 现在已经没有了
5. 根据分层生成一个绘制列表,提交到合成线程
- - - -
6. 在合成线程里,会把大的图层分成图块,再传递给光栅化线程池
7. 光栅化可以把图块转换成位图 
8. 当所有的图块都被光栅化之后,合成线程会给浏览器线程提交绘制图块命令 drawquard
9. 在浏览器线程中有个模块 viz 用来接收drawquard 命令,收到之后会把位图信息存储在内存中,并显示在屏幕上

## 所谓的性能优化 其实就是更快地加载页面与交互响应
### 加载(网络层面的优化)
![](%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/D059576B-DB64-4FE3-95B9-CBB3B941C453.png)

页面加载的过程中,有下载时间,解析时间,渲染时间
* 下载时间优化: 减少资源大小  减少资源数量(减少请求数量)    DNS优化 CDN减少RTT时长,  开启HTTP2
* 会阻塞页面渲染的资源 我们称为关键资源,包括js css html, 而图片,音频,视频之类的不会阻塞页面渲染,如果我们知道js中不会操作dom,那么可以将js标签加上defer(一边解析HTML,一边下载,解析完成后执行)或者async(一边解析一边下载,下载完成后停止解析HTML,开始解析js)
### 交互
交互层面的优化首先要保证流畅,也就是要保证浏览器的帧数,渲染帧生成过慢的时候,就会感觉到卡顿.
一帧的渲染过程: 
![](%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/BDD70185-CEFD-4E14-AFC8-84FA83BE63B5.png)
**优化JavaScript执行效率**
1. 不要霸占主线程太久,不要有长任务,如果有就拆解成小任务,时间分片,fiber的思想
2. 避免强制布局同步,在JS中修改DOM后,马上去获取新DOM节点的布局或者样式信息. 就会造成强制布局同步
3. 避免布局抖动,频繁在一个任务中修改布局
4. 合理利用CSS合成动画, 避免JS动画, 添加will-change


如果修改了布局,会触发重排 ,等于重新渲染一次页面. 效率最差
修改了颜色,触发重绘
触发了变形,渐变,动画等,在合成线程,只会触发合成,执行效率最高

